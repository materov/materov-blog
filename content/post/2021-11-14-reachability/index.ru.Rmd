---
title: Анализ степени достижимости географически распределенных объектов
author: admin
date: '2021-11-15'
slug: reachability
categories: ["R"]
tags: ["rstats", "геоданные"]
subtitle: 'пример анализа степени достижимости социально значимых объектов и объектов с массовым пребыванием людей на языке программирования R'
summary: 'В статье будут рассмотрены возможности языка программирования R в применении к анализу расстояний между объектами городской структуры.'
authors: 
- admin
lastmod: '2021-11-14T22:26:10+07:00'
featured: yes
math: true
image:
  caption: ''
  focal_point: ''
  preview_only: yes
projects: []
---

```{r applause-button, echo=FALSE}
applause::button(
  color = "#0C4047",
  width = "58px",
  multiclap = T
)
```


В одной из [предыдущих записей](https://materov-blog.netlify.app/post/geodata-fire/) в блоге были рассмотрены возможности языка программирования **R** в применении к построению географических карт дорог городской структуры на основе [OpenStreetMap](https://www.openstreetmap.org/). В продолжении исследования такого рода, изучим вопрос о степени достижимости потенциальных объектов пожара пожарно-спасательными подразделениями. При этом особое внимание при оценке расстояния и времени прибытия подразделениями должно уделяться социально значимым объектам и объектам с массовым пребыванием людей.

Загрузим необходимые для работы библиотеки. Для получения данных с **OpenStreetMap** используется библиотека `osmdata`, для работы с геоданными -- библиотека `sf`, библиотека `osrm` является связующим звеном между **R** и сервисом [OSRM](http://project-osrm.org/) для определения расстояния между объектами, времени движения и кратчайшего пути.

```{r setup, warning=FALSE, message=FALSE}
library(tidyverse)
library(magrittr)

# для работы с геоданными
library(osmdata)
library(osrm)
library(sf)
```

В первую очередь, нам понадобится базовая карта-подложка города или его района. Идея такого рода карты принадлежит [@taraskaduk](https://twitter.com/taraskaduk) и рассмотрена в [его блоге](https://taraskaduk.com/posts/2021-01-18-print-street-maps/). Фиксируем город (в нашем случае -- Красноярск) и значения ключей для **OpenStreetMap**.

```{r warning=FALSE, message=FALSE}
my_place <- "Krasnojarsk Russia"

highway_sizes <- tibble::tribble(
          ~highway, ~highway_group, ~size,
        "motorway",        "large",   0.5,
   "motorway_link",        "large",   0.3,
         "primary",        "large",   0.5,
    "primary_link",        "large",   0.3,
       "secondary",       "medium",   0.3,
  "secondary_link",       "medium",   0.3,
        "tertiary",       "medium",   0.3,
   "tertiary_link",       "medium",   0.3,
     "residential",        "small",   0.2,
   "living_street",        "small",   0.2,
    "unclassified",        "small",   0.2,
         "service",        "small",   0.2,
         "footway",        "small",   0.2
  )
```

Далее, получим картогрофические данные, включающие в себя дорожную сеть улиц, железные дороги и водные объекты -- реки и озера.

```{r warning=FALSE, message=FALSE}
# streets
streets_osm <- opq(my_place) %>%
  add_osm_feature(key = "highway", 
                  value = highway_sizes$highway) %>%
  osmdata_sf() %>% 
  unname_osmdata_sf()
```

```{r warning=FALSE, message=FALSE}
streets <- streets_osm$osm_lines %>% 
  dplyr::select(osm_id, name, name.en, highway, maxspeed, oneway, surface) %>% 
  mutate(length = as.numeric(st_length(.))) %>% 
  left_join(highway_sizes, by="highway") %>% 
  dplyr::filter(highway_group != "small" | length >= quantile(length, probs = 0.25))
```

```{r warning=FALSE, message=FALSE}
# railways
railways <- getbb(my_place) %>%
  opq()%>%
  add_osm_feature(key = "railway", 
                  value = "rail") %>%
  osmdata_sf()

railways_osm <- opq(my_place) %>%
  add_osm_feature(key = "railway", value="rail") %>%
  osmdata_sf() %>% 
  unname_osmdata_sf()

railways <- railways_osm$osm_lines %>% 
  dplyr::select
```

```{r warning=FALSE, message=FALSE}
# water
water_osm <- opq(my_place) %>%
  add_osm_feature(key = "natural", value = "water") %>%
  osmdata_sf() %>% 
  unname_osmdata_sf()

river_osm <- opq(my_place) %>%
  add_osm_feature(key = "waterway", value = c("river", "riverbank")) %>%
  osmdata_sf() %>% 
  unname_osmdata_sf()

water <- 
  c(water_osm, river_osm) %>% 
  .$osm_multipolygons %>% 
  dplyr::select(osm_id, name) 
```







